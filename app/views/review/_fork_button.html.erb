<button id="fork-button" type="button"">fork</button>

<script>
'use strict';
$(() => {

  const $button = $('#fork-button');
  const tip = `create a new<br/>exercise from this<br/>traffic-light's files`;
  cd.createTip($button, tip);
  $button.click(() => openForkDialog());

  //- - - - - - - - - - - - - - - - - - - - - - - - -
  const openForkDialog = () => {
    const xPos = $button.offset().left;
    const yPos = $button.offset().top + 30;
    const $div = $('<div>', { class:'info' }).append(
      $("<div>create a new exercise<br/>from this traffic-light's files</div>"),
      $makeButton('individual'),
      $makeButton('group')
    );
    $('<div id="fork-dialog">').append($div).dialog({
              title: cd.dialogTitle('fork'),
              modal: true,
              width: 300,
           autoOpen: true,
           position: [ xPos, yPos ],
      closeOnEscape: true,
    });
  };

  //- - - - - - - - - - - - - - - - - - - - - - - - -
  const $makeButton = (type) => {
    return $('<button>', {
         id: type,
       type: 'button',
       text: `${type} exercise`
    }).click(() => {
      fork(type);
      $('#fork-dialog').remove();
    });
  };

  //- - - - - - - - - - - - - - - - - - - - - - - - -
  const fork = (kataId, index, type) => {
    $.ajax({
            type: 'POST',
             url: `/forker/fork_${type}?id=${cd.review.id()}&index=${cd.review.index()}`,
        dataType: 'json', // format we want response in
           async: false,
         success: (response) => {
           if (response.forked) {
             window.open(`/creator/enter?id=${response.id}`);
           } else {
             cd.dialogError(response.message);
           }
        }
    });
  };

});
</script>
