<div class="review predict-counts">
  <div class="tick box">
    <div class="tick count">0</div>
    <img src="/images/traffic-light/circle-tick.png">
  </div>
  <div class="circle box">
    <div class="cross count">0</div>
    <img src="/images/traffic-light/circle-cross.png">
  </div>
  <div class="total">0&nbsp;predictions</div>
</div>

<script>
'use strict';
$(() => {

  const $predictCounts = $('.review.predict-counts');

  const counts = { tick: 0, cross: 0 };

  cd.review.predictCounts = {};

  cd.review.predictCounts.reset = () => {
    Object.keys(counts).forEach(key => counts[key] = 0);
    removeRagBackground();
    setPredict('cross', 0);
    setPredict('tick', 0);
    updateTotal();
  };

  cd.review.predictCounts.update = (light) => {
    const colour = light.colour;
    if (cd.lib.hasPrediction(light) && colour != 'pulling' && colour != 'faulty') {
      const isRight = (colour === light.predicted);
      const name = isRight ? 'tick' : 'cross';
      const $count = setPredict(name, counts[name] += 1);
      removeRagBackground();
      if (!isRight) {
        $count.addClass(light.predicted);
      }
      updateTotal();
    }
    else if (!cd.lib.isRevert(light)) {
      removeRagBackground();
    }
  };

  const removeRagBackground = () => {
    $('.count', $predictCounts).removeClass('red amber green');
  };

  const setPredict = (name, count) => {
    const $count = $(`.${name}.count`, $predictCounts);
    $count.text(count);
    return $count;
  };

  const updateTotal = () => {
    const total = counts.tick + counts.cross;
    $('.total', $predictCounts).html(`${total}&nbsp;prediction${plural(total)}`);
  };

  const plural = (n) => n == 1 ? '' : 's';

});
</script>
