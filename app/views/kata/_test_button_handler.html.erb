<script type="text/javascript"><!--
'use strict';
$(() => {
  // Called from 3 places
  // 1. when you click [test]
  // 2. when you hot-key Alt-T
  // 3. when you checkout from a diff-review
  cd.testButton.click(() => {
    const form = cd.testButton.closest('form');
    cd.saveCodeFromSyntaxHighlightEditors();
    cd.testButton.disable();
    cd.showWaitSpinner(() => {
      $.ajax({
           timeout: 30000, // 30 seconds
              type: 'POST',
               url: form.attr('action'),
              data: form.serialize(),
          complete: complete,
             error: error
      });
    });
  });

  //- - - - - - - - - - - - - - - - - - - - - - -

  const complete = (_xhr, _status) => {
    cd.hideWaitSpinner(() => {
      cd.testButton.enable();
    });
  };

  //- - - - - - - - - - - - - - - - - - - - - - -

  const error = (request, status, thrown) => {
    cd.dialogError([
      request.responseText,
      '----------------------------',
      `Status=${status}`,
      thrown
    ].join("\n"));
  };

});
//--></script>
