
const appendTestTrafficLight = function() {
  const colour = "<%= @colour %>";
  const lightsCount = $('.diff-traffic-light').size();
  const img = $('<img>', {
    'src': '/images/bulb_' + colour + '.png',
    'alt': colour + ' traffic-light'
  });
  const div = $('<div>', {
    'class': 'diff-traffic-light',
    'data-tip':'simple_review_traffic_light',
    'data-colour': colour,
    'data-was-tag': lightsCount,
    'data-now-tag': lightsCount + 1
  });
  const td = $('<td>');
  div.append(img);
  td.append(div);
  $('.traffic-lights-count').parent().before(td);
  cd.setupReviewTrafficLight(div);
};

//- - - - - - - - - - - - - - - - - - - - - -

const updateTrafficLightCount = function() {
  $('.traffic-lights-count')
    .html("<%= js_partial('traffic_lights_count') %>");
};

const updateTrafficLightPieChart = function() {
  $('#traffic-lights-pie-chart')
    .html("<%= js_partial('traffic_lights_pie_chart') %>");
};

//- - - - - - - - - - - - - - - - - - - - - -

const addNewFiles = function() {
  $("#visible-files-container").append("<%= js_partial('new_files') %>");
};

//- - - - - - - - - - - - - - - - - - - - - -

const removeDeletedFiles = function() {
  <% @deleted_files.keys.each do |filename| %>
    cd.deleteFile("<%= filename %>");
  <% end %>
};

//- - - - - - - - - - - - - - - - - - - - - -

const updateChangedFiles = function() {
  <% @changed_files.keys.each do |filename| %>
    cd.deleteFile("<%= filename %>");
  <% end %>
  $("#visible-files-container").append("<%= js_partial('changed_files') %>");
};

//- - - - - - - - - - - - - - - - - - - - - -

$('#output').html("<%= js_partial('output') %>");

appendTestTrafficLight();
updateTrafficLightCount();
updateTrafficLightPieChart();

addNewFiles();
removeDeletedFiles();
updateChangedFiles();

cd.switchEditorToCodeMirror('output');
cd.scrollAvatarImageIntoView();

