
1 controller-test fails

  1) Failure:
CheckoutTest#test_'7de177',
 in group kata, checkout a different avatar's traffic-light
 [checkout_test.rb:68]:
 ====> "message": "Out of order event"
 I think this is because of moving to v2...

       unless index == last_index+1  
        #raise 'Out of order event'
        raise "Out of order event #{index} #{last_index+1}"
      end
produces
  "Out of order event 2 1"
So index==2
last_index+1 == 1
so last_index==0

Reminder of context of saver.checked_out()
saver.kata_checked_out is in web's SaverService
It is called in source/app/controllers/kata_controller.rb L137
KataController.checkout says it is called from review page
source/config/routes.rb has 
  scope path: '/kata', controller: :kata do
    post 'checkout'          => :checkout,    :constraints => { :format => :json }
  end  
So looking for 'kata/checkout' POST call in review 
source/app/views/review/_checkout_button.html.erb has L30
const checkout = () => {
    const args = {       // where we are writing to
      id: kata.id,       // eg 'Xd4f2P'
      index: kata.index, // eg 17
      src_id: review.id, // where we are reading from
      src_index: review.index,
      src_avatar_index: review.avatarIndex
    };
    $.post('/kata/checkout', args, (data) => {...});

So I think this is for checking out a different avatar's traffic-light.
So demo needs a second avatar.

------------------------------------------------------------------

- fix checkout test Failure
- update remaining kata.incrementIndex() calls
  - L13  source/app/views/kata/_index.html.erb (definition)
  - L145 source/app/views/kata/run_tests.js.erb (in revert())
  - L40  source/app/views/review/_checkout_button.html.erb 
- handle auto-revert on [test] page
- fix existing tests. See app_controller_test_base.rb post_run_tests()
  which does an auto-increment of index
- start adding new controller tests

- make (C)(D)(R)(E) icons visible when extra[x] is ticked
- add diff_summary tooltips for (C)(D)(R)(E) icons

------------------------------------------------------------------

Note: all web code is on a branch and so is not even on beta yet.
When it is deployed to beta/prod then inter-test-events will start to
be created, since saver has inter-test-events in beta/prod already.

------------------------------------------------------------------

stdout/stderr/status appear below the file knave when reviewing 
an inter-test-event index. They should not.

------------------------------------------------------------------

Upgrade demo to bring up a v2 kata with inter-test events.
Use it to get into review page for working on showing inter-test events.
Have to think about how to handle [revert]
Do I allow revert from an inter-test event? I think yes.
Will need (C)(D)(R)(E) icons with an underbar.

------------------------------------------------------------------

extra[x] checkbox is not very visible.
When you open a review page, should it be checked by default so
that inter-test-events are immediately visible?

------------------------------------------------------------------

diff tool-tips will need a little work. Will need to add a 'title'
eg created/red/amber/green will now also need 
file-created/file-deleted/file-renamed/file-edited

------------------------------------------------------------------

Have to think about how to handle auto-revert on the kata page 
(when [test] is pressed).
Do I go back to the previous traffic-light? 
That would retain current behaviour from the edit page point of view.
What other options are there?

------------------------------------------------------------------

See if removing error-route from app/config/routes.rb 
improves dialog-box errors, eg when you get a server 500

------------------------------------------------------------------

In a v2 kata, if you create inter-test-events, and traffic-lights are at
indexes 2,4,7 then these indexes are visible in the diff-tool-tip.
If you click light(eg index=4) then in review mode you see that light 
underbarred and the navigator-index shown is 4.
You can use [<][>] to navigate to a non-test-event and
- the diff is shown
- the index will update
- the underbar will be removed.
Perhaps this is almost enough?!
Could extra[x] only control what the underlying events are?

------------------------------------------------------------------

The extra[x] checkbox in review mode should go nearer to the 
<< < 8 > >> navigator.

------------------------------------------------------------------

Controller-tests currently use v1 kata. 
Some tests failed because of this.
Switched to default v2 in create_language_kata()

In app_controller_test_base.rb we have this:

  def post_run_tests(options = {})
    post '/kata/run_tests', params:run_test_params(options)
    @index += 1
    assert_response :success, response.body
  end

Need to upgrade the tests so they use a v2 kata

------------------------------------------------------------------

In review-mode, always do diff-summary of index-1,index
and always show file-type markers. Make the diff[x] checkbox
control whether the [+][-] diffs are visible. Need to try this.
What about [+] created files and [-] deleted files?

Polyfill old checkouts on model?
