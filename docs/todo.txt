
app/controllers/application_controller.rb container render 404, 500
In web, improve dialog-box errors, eg when you get a server 500
 this needs to be logged so it is visible in a docker-logs command.

In revert_test.rb instead of 
  @files[filename] = 'Hello'
if you write
  @files[filename] = {'content' => 'Hello'}
then it seems to cause saver to silently drop its incoming call.
There needs to be some pydantic-like checking of the parameters.

Any app-controller tests use RunnerService when they could use RunnerStub?

Are app-controller tests still using v0/v1 manifests?
  Use v2 in all tests.
  Create multi-version-tests? See source/test/test_base.rb v_tests

Need to find how to put the actual 404/500 error message into the view.
  source/config/environments/production.rb
    # Show raw exceptions
    config.action_dispatch.show_exceptions = true
    # Show full error reports
    config.consider_all_requests_local = true

------------------------------------------------------------------

- If you are in [test] mode and do an edit and then switch to review mode.
  Should this switch cause a file-edit event?
  I think no. But, if you are then in review mode and you click revert/checkout 
  then you should get a file-edit event before the revert/checkout.

- saver v2 should do checked_out2 and reverted2

- saver v2 is always returning { 'minor_index' => 0 } which is wrong

- Tool tip for checkout fixed by adding major/minor index.
  Eg
  {
    "checkout": {
      "id": "vQfTr8",
      "index": 4,
      "avatarIndex": 51
    },
  }
  has become 
  {
    "checkout": {
      "id": "vQfTr8",
      "index": 4,
      "major_index": 2,
      "minor_index": 0,
      "avatarIndex": 51
    },
  }
  Now need to polyfill the "checkout" in saver for v0,v1,v2 where 
  {
    "checkout": {
      "id": "vQfTr8",
      "index": 4,
      "avatarIndex": 51
    },
  }
  becomes
  {
    "checkout": {
      "id": "vQfTr8",
      "index": 4,
      "major_index": 4,
      "minor_index": 0,
      "avatarIndex": 51
    },
  }
  v0,v1 will be repeat of index, and 0
  for v2 will need to check if id matches manifest, and if not 
  (different avatar) then will need to get its events to calculate 
  correct major/minor.

- Make tool-tip for checkout/revert button more obvious what the difference is.
  Currently says "Revert back to this traffic-light's files"
  Could be refreshed when currently selected event changes. eg
  ...
  Currently reviewing 2.3 File edited.
  Click [revert] to go back to these files.
  ...
  Currently reviewing hippo 4 Red.
  You are an elephant.
  Click [checkout] to make these files your files.

- Reverting to a non RAG event...
  What is the tool-tip for this?
  Is it 'reverted to X.Y' and is only visible in diff-mode=detailed?

- In review mode with diff-detailed selected, when a RAG is chosen the selection picks a non 
  s/s/s file. Instead, select a single 'output' filename instead of stdout/stderr/status 
  (same as [test] page).

- Auto-reverted tool-tip is 'Reverted to...'
  Maybe this should be more obvious as, eg, 'Predicted wrong, auto-reverted to...'
  
- review/_traffic_lights.html.erb has this, which looks suspicious/wrong.
  Why is it needed by [fork] and [checkout] ?
      if (review.index === -1) {
        review.index = review.events.length - 1; // Need by [fork] and [checkout]
      }

- The diff tool-tip when details[x] now looks too busy.
  A RAG in diff-mode=detailed does not need a diff at all!
  The file-events themselves can each contain details of the one file they are about. 
  Eg Instead of...
    - + =
        15 = readme.txt
    1 1  7 ! hiker.sh 
         8 = test_hiker.sh
         3 = bats_help.sh
         2 = cyber-dojo.sh 
  
   it can be simply...
    1 1  hiker.sh 

- In traffic-light-navigator, I think lastEventIndex() and lastEventIndex()
  can be simplified using code in _review.html.erb

- In dashboard, in refresh.js save events in global so they are available 
  to JS, eg to calculate the previous index. Prepares the way for details[x]
  checkbox in dashboard.

- Fix layout/CSS for review-mode from dashboard

- Switched to a dotted-index view
  Check CSS copes with variable size in traffic-light-navigator, eg
  [<] [14.22] [>]
  Don't want it to change size, so need to increase the width.
  Have 2 sizes for the index box
   - larger  for diff-detailed ON
   - smaller for diff-detailed OFF

- On the dashboard have diff-extra[x] checkbox.

- Show (o) detailed radio-button only if there are inter-test events?

- Polyfill old checkouts on saver model?
  having index=0 -> colour="create" would be handy.
  adding diff-added/deleted-count in index=0 also

- Refactor JS so refresh methods are called only when needed.

- In demo, add events for 'faulty' and 'pulling'.
  Check review with details[x] and moving [<][>] across them

- cd.lib.isLight(event) also gives true for create event. Not clear?
  Add cd.lib.isTest(event) and check that also gives true for 
  'faulty' and 'pulling'
  Maybe rename cd.lib.isFileEvent to cd.lib.isMinor(event)?

- Sometimes get RAG tool-tip appearing in top-left and not going away.
  Maybe set a timeout of a few seconds so it always goes away?

------------------------------------------------------------------

- pre-release
- switch web to call saver.ran_tests() instead of saver.ran_tests2()      
- comment out JS calls to file-create/delete/rename/edit 
- do careful check that everything still works: 
    [test]-review, [dashboard]-review, revert, checkout, predict, etc
- check for stability, continue testing/checking

- release
  - use saver.ran_tests2()
  - turn on file-create/delete/rename/edit
  - check index numbering in details mode

- post-release
  o) reimplement saver.ran_test() to be the same as saver.ran_tests2()
  o) switch web to call saver.ran_tests()
  o) delete saver.ran_tests2()

