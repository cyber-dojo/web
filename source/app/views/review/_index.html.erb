<script>
'use strict';
$(() => {

  const review = cd.review;

  review.firstEventIndex = () => {
    const events = review.events;
    if (review.diffRadio.isDetailed()) {
      return (events.length == 0) ? 0 : 1;
    }
    else {
      for (var i = 1; i < events.length; i++) {
        if (events[i].major_index == 1) {
          return i;
        }
      }
      return 0;
    }
  };

  review.lastEventIndex = () => {
    const events = review.events;
    const lastEvent = events[events.length - 1];
    const lastIndex = lastEvent.index;

    if (review.diffRadio.isDetailed()) {
      return lastIndex;
    } 
    else {
      return review.majorEventIndex(lastIndex);
    }
  };

  review.previousIndex = (index) => {
    if (index == 0) {
      return 0;
    } 
    else if (review.diffRadio.isDetailed()) {
      return index - 1;
    } 
    else {
      return review.majorEventIndex(index - 1);
    }
  };

  review.majorEventIndex = (index) => {
    // Make sure we are on a light
    // Eg if index=10, viewed as 2.3, and you unclick detailed[x] then go back to 2
    // which is index=7, which is 10-3, where the 3 comes from the minor_index of 2.3
    // Eg if index=10, viewed as 2, and you unclick detailed[x] then stay on 2 
    // which is index=10, which is 10-0, where the 0 comes the minor_index of 2.0

    return index - review.events[index].minor_index;
  };

});
</script>
