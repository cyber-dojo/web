<script>
'use strict';
$(() => {

  // Each event has three indices. 
  // The simplest is 'index' where review.events[i].index == i
  // The other two are 'major_index' and 'minor_index' where
  // - minor_index != 0 indicates an inter-test file-event, eg a file-edit 
  //   For example: 
  //       event[15].index == 15
  //       event[15].major_index == 4
  //       event[15].minor_index == 3 
  //   means that event[15] is displayed as 4.3 (when diff? detailed mode is on)
  //
  // - minor_index == 0 indicates a red/amber/green test-event.
  //   For example: 
  //       event[22].index == 22
  //       event[22].major_index == 5
  //       event[22].minor_index == 0
  //   means that event[22] is displayed as 5

  const review = cd.review;

  review.firstEventIndex = () => {
    const events = review.events;
    if (review.diffRadio.isDetailed()) {
      return (events.length == 1) ? 0 : 1;
    }
    else {
      for (var i = 1; i < events.length; i++) {
        if (events[i].major_index == 1) {
          return i;
        }
      }
      return 0;
    }
  };

  review.lastEventIndex = () => {
    const lastIndex = review.lastEvent().index;
    if (review.diffRadio.isDetailed()) {
      return lastIndex;
    } 
    else {
      return review.majorEventIndex(lastIndex);
    }
  };

  review.previousIndex = (index) => {
    if (index == 0) {
      return 0;
    } 
    else if (review.diffRadio.isDetailed()) {
      return index - 1;
    } 
    else {
      return review.majorEventIndex(index - 1);
    }
  };

  review.majorEventIndex = (index) => {
    // Make sure we are on a light
    // Eg if index=10, viewed as 2.3, and you uncheck detailed[x] then go back to 2
    // which is index=7, which is 10-3, where the 3 comes from the minor_index of 2.3
    // Eg if index=10, viewed as 2, and you uncheck detailed[x] then stay on 2 
    // which is index=10, which is 10-0, where the 0 comes the minor_index of 2.0

    return index - review.events[index].minor_index;
  };

});
</script>
