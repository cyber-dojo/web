<button id="revert-button" type="button">revert</button>

<script>
'use strict';
$(() => {

  const kata = cd.kata;
  const review = cd.review;

  const $button = $('#revert-button');

  const refreshToolTip = () => {
    cd.createTip($button, () => {
      const event = review.currentEvent();
      const rag = cd.cssColour(event.colour, `${event.major_index}`);
      const colour = event.index == 0 ? '' : cd.cssColour(event.colour);
      const action = `Resume coding & testing`;
      const context = 'after reverting to';
      if (kata.id == review.id || review.avatarIndex == '') {
        const name = '';
      }
      else {
        const name = cd.lib.avatarName(review.avatarIndex) + ' ';
      }
      const identity = `${name}${rag} ${colour}`;
      return `${action}<br/>${context}<br/>${identity}`;
    });
  };

  $button.click(() => review.fadeOut(cd.revertOrCheckout));

  review.revertButton = {
    show: () => {
      refreshToolTip();
      $button.show();
    },
    enable: () => $button.prop('disabled', false),
    disable: () => $button.prop('disabled', true),
    refresh: () => {
      refreshToolTip();
      if (review.isFromDashboardPage()) {
        review.revertButton.disable();
      }
      else if (cd.review.isOnFileEvent()) {
        review.revertButton.disable();
      } 
      else if (kata.id != review.id) {
        review.revertButton.disable();
      }
      else {
        review.revertButton.enable();
      }
    }
  };

});
</script>
